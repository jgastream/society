<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mwtether Society</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root{--bg:#fafafa;--text:#1a1a1a;--muted:#666;--accent:#d91
  ;--border:#e0e0e0;}
  [data-theme="dark"]{--bg:#0f1114;--text:#e5e5e5;--muted:#888;--border:#2d3136;}
  *{box-sizing:border-box;margin:0;padding:0;}
  body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);line-height:1.5;transition:all .3s;min-height:100vh;padding-bottom:80px;position:relative;}
  header,.topnav,#searchInput,.articles{max-width:1400px;margin:0 auto;padding:0 20px;}
  .theme-toggle{position:fixed;top:12px;right:12px;background:var(--accent);color:#fff;border:none;padding:8px 14px;border-radius:6px;font-weight:600;cursor:pointer;z-index:100;font-size:0.85rem;}
  header{text-align:center;padding:36px 20px 20px;}
  h1{font-size:2.1rem;font-weight:700;letter-spacing:-1.2px;}
  .tagline{color:var(--muted);font-size:1.05rem;margin-top:8px;}
  .topnav{display:flex;justify-content:center;gap:28px;padding:16px 0 14px;border-bottom:1px solid var(--border);flex-wrap:wrap;font-size:0.95rem;font-weight:600;}
  .topnav button,.topnav a{background:none;border:none;padding:10px 0;color:var(--muted);cursor:pointer;border-bottom:3px solid transparent;transition:.2s;text-decoration:none;}
  .topnav button.active,.topnav a:hover{color:var(--text);border-bottom-color:var(--accent);}
  #searchInput{display:block;width:100%;margin:24px auto;padding:12px 16px;border:1px solid var(--border);border-radius:10px;background:var(--bg);color:var(--text);font-size:1rem;}
  .articles{padding:20px 0 50px;display:flex;flex-direction:column;gap:0;}
  .article{display:flex;gap:20px;padding:24px 0;border-bottom:1px solid var(--border);text-decoration:none;color:inherit;transition:background .2s;}
  .article:hover{background:var(--bg === #fafafa ? #f5f5f5 : #191c20);}
  .article-img-wrapper{flex:0 0 160px;height:110px;overflow:hidden;background:#000;border-radius:8px;}
  .article-img{width:100%;height:100%;object-fit:cover;transition:transform .3s;}
  .article:hover .article-img{transform:scale(1.08);}
  .article-content{flex:1;min-width:0;display:flex;flex-direction:column;}
  .article h3{font-size:1.35rem;font-weight:700;margin-bottom:8px;line-height:1.3;}
  .article p{color:var(--muted);font-size:1rem;margin-bottom:14px;line-height:1.55;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
  .meta{display:flex;justify-content:space-between;align-items:center;font-size:0.85rem;color:var(--muted);margin-top:auto;}
  .date{font-weight:600;}
  .category{background:var(--accent);color:#fff;padding:5px 12px;border-radius:6px;font-weight:700;font-size:0.75rem;text-transform:uppercase;}
  .loading,.empty{text-align:center;padding:100px 20px;color:var(--muted);font-size:1.1rem;}
  .footer-fixed{position:fixed;bottom:0;left:0;width:100%;background:var(--bg);text-align:center;padding:14px 20px;font-size:0.85rem;color:var(--muted);border-top:1px solid var(--border);z-index:99;}

  @media (max-width:768px){
    h1{font-size:1.9rem;}
    .article-img-wrapper{flex:0 0 140px;height:96px;}
    .article h3{font-size:1.25rem;}
  }
  @media (max-width:560px){
    header{padding:32px 16px 18px;}
    h1{font-size:1.75rem;}
    .article{gap:16px;padding:20px 0;}
    .article-img-wrapper{flex:0 0 120px;height:84px;}
    .article h3{font-size:1.18rem;}
    .topnav{gap:16px;font-size:0.9rem;}
  }

  .ageModal{position:fixed;inset:0;background:rgba(0,0,0,.98);display:none;align-items:center;justify-content:center;z-index:9999;}
  .ageModal.active{display:flex;}
  .ageModalContent{background:var(--bg);padding:36px 28px;border-radius:14px;width:90%;max-width:360px;text-align:center;border:1px solid var(--border);}
  .ageModalContent h2{color:var(--accent);font-size:1.7rem;margin-bottom:14px;}
</style>
</head>
<body data-theme="light">

<button class="theme-toggle" id="themeToggle">Dark</button>

<header>
  <h1>MWtether Society</h1>
  <p class="tagline">Global News• Stories• Scandals• Entertainment</p>
</header>

<nav class="topnav">
  <button data-tab="all" class="tabBtn active">All</button>
  <button data-tab="news" class="tabBtn">News</button>
  <button data-tab="stories" class="tabBtn">Stories</button>
  <button data-tab="entertainment" class="tabBtn">Entertainment</button>
  <button data-tab="scandals" class="tabBtn">Scandals</button>
  <a href="#">About</a>
</nav>

<input type="text" id="searchInput" placeholder="Search article…">

<main class="articles" id="articlesContainer">
  <div class="loading">Loading…</div>
</main>

<div class="footer-fixed">
  © 2025 Society. All rights reserved.
</div>

<div class="ageModal" id="ageModal">
  <div class="ageModalContent">
    <h2>Scandals Section</h2>
    <p>You may have found some articles not suitable for your age. Please answer the question below to verify that you attend class 1 of secondary level mathematics. </p>
    <p style="margin:24px 0;font-weight:600;">Solve: 3<sup>2x</sup> = 81</p>
    <input type="text" id="ageAnswer" placeholder="answer is 2" autofocus>
    <button id="submitAge">Enter</button>
    <div id="wrongMsg" style="color:#ff3333;margin-top:14px;display:none;font-weight:600;">Wrong answer – try again</div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getFirestore, collection, getDocs, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

  const app = initializeApp({
    apiKey: "AIzaSyDZEiPKwBXshLCdYqQ1kyaEzKz_SJYJH2k",
    authDomain: "mwtether.firebaseapp.com",
    projectId: "mwtether",
    storageBucket: "mwtether.firebasestorage.app",
    messagingSenderId: "95370110625",
    appId: "1:95370110625:web:e53bde7c65bb9da57d32e0"
  });

  const db = getFirestore(app);
  const container = document.getElementById('articlesContainer');
  const ageModal = document.getElementById('ageModal');

  // Theme
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.body.setAttribute('data-theme', savedTheme);
  document.getElementById('themeToggle').textContent = savedTheme === 'light' ? 'Dark' : 'Light';
  document.getElementById('themeToggle').onclick = () => {
    const newTheme = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
    document.body.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    document.getElementById('themeToggle').textContent = newTheme === 'light' ? 'Dark' : 'Light';
  };

  let scandalsUnlocked = localStorage.getItem('scandalsUnlocked') === 'true';
  let currentTab = 'all';
  let currentSearch = '';
  let savedScroll = 0;

  const saveScroll = () => savedScroll = window.scrollY;
  const restoreScroll = () => requestAnimationFrame(() => window.scrollTo(0, savedScroll));

  document.getElementById('submitAge').onclick = () => {
    if (document.getElementById('ageAnswer').value.trim() === '2') {
      scandalsUnlocked = true;
      localStorage.setItem('scandalsUnlocked', 'true');
      ageModal.classList.remove('active');
      loadArticles();
    } else document.getElementById('wrongMsg').style.display = 'block';
  };

  const formatDate = (ts) => {
    if (!ts?.seconds) return 'Just now';
    const date = new Date(ts.seconds * 1000);
    const now = new Date();
    const diff = (now - date) / 1000;
    if (diff < 60) return 'Just now';
    if (diff < 3600) return `${Math.floor(diff/60)}m ago`;
    if (diff < 86400) return `${Math.floor(diff/3600)}h ago`;
    if (diff < 604800) return `${Math.floor(diff/86400)}d ago`;
    return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
  };

  // Tab switching
  document.querySelectorAll('.tabBtn').forEach(b => {
    b.onclick = () => {
      saveScroll();
      document.querySelectorAll('.tabBtn').forEach(x => x.classList.remove('active'));
      b.classList.add('active');
      currentTab = b.dataset.tab;

      if (currentTab === 'scandals' && !scandalsUnlocked) {
        ageModal.classList.add('active');
        document.getElementById('wrongMsg').style.display = 'none';
        document.getElementById('ageAnswer').value = '';
      } else {
        ageModal.classList.remove('active');
        loadArticles().then(restoreScroll);
      }
    };
  });

  // Search
  document.getElementById('searchInput').oninput = () => {
    saveScroll();
    currentSearch = document.getElementById('searchInput').value.toLowerCase();
    setTimeout(() => loadArticles().then(restoreScroll), 300);
  };

  async function loadArticles() {
    container.innerHTML = '<div class="loading">Loading…</div>';
    const snap = await getDocs(collection(db, 'videos'));
    const docs = snap.docs
      .map(d => ({ id: d.id, ...d.data() }))
      .sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));

    container.innerHTML = '';

    docs.forEach(item => {
      const d = item;
      const type = (d.type || 'all').toLowerCase();

      if (type === 'scandals' && !scandalsUnlocked) return;
      if (currentTab !== 'all' && type !== currentTab) return;
      if (currentSearch && !d.title?.toLowerCase().includes(currentSearch) && !(d.description||'').toLowerCase().includes(currentSearch)) return;

      const article = document.createElement('a');
      article.className = 'article';
      article.href = `info.html?id=${d.id}`;

      let categoryDisplay = 'UPDATE';
      if (type === 'news') categoryDisplay = 'NEWS';
      else if (type === 'stories') categoryDisplay = 'STORIES';
      else if (type === 'entertainment') categoryDisplay = 'ENTERTAINMENT';
      else if (type === 'scandals') categoryDisplay = 'SCANDALS';

      article.innerHTML = `
        <div class="article-img-wrapper">
          <img class="article-img" src="${d.thumbnail || 'https://via.placeholder.com/160x110'}" alt="${d.title}">
        </div>
        <div class="article-content">
          <h3>${d.title || 'Untitled'}</h3>
          <p>${(d.description || '').slice(0,200)}…</p>
          <div class="meta">
            <div><span class="date">${formatDate(d.timestamp)}</span></div>
            <span class="category">${categoryDisplay}</span>
          </div>
        </div>
      `;
      container.appendChild(article);
    });

    if (!container.hasChildNodes()) container.innerHTML = '<div class="empty">No post found.</div>';
  }

  window.onload = () => {
    setTimeout(() => {
      if (savedScroll > 100) window.scrollTo(0, savedScroll);
    }, 100);
  };

  loadArticles();
</script>
</body>
</html>